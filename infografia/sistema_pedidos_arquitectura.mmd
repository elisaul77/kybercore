
graph TB
    subgraph Capa de PresentaciÃ³n - Frontend
        UI_Dashboard[ğŸ“Š Dashboard Principal<br/>Vista general de pedidos activos]
        UI_Orders[ğŸ“‹ Lista de Pedidos<br/>Filtros: estado, prioridad, cliente]
        UI_OrderDetail[ğŸ” Detalle de Pedido<br/>Progreso, lÃ­neas, batches]
        UI_OrderForm[â• Formulario Pedido<br/>CreaciÃ³n/ediciÃ³n]
        UI_Customers[ğŸ‘¥ GestiÃ³n Clientes<br/>CRUD de clientes]
        UI_Reports[ğŸ“ˆ Reportes & MÃ©tricas<br/>KPIs, grÃ¡ficos, anÃ¡lisis]
    end
    
    subgraph Capa de LÃ³gica - Backend Controllers
        API_Orders[ğŸ® Orders Controller<br/>CRUD de pedidos]
        API_Customers[ğŸ‘¤ Customers Controller<br/>CRUD de clientes]
        API_Production[ğŸ­ Production Controller<br/>Tracking de producciÃ³n]
        API_Metrics[ğŸ“Š Metrics Controller<br/>Agregaciones y reportes]
    end
    
    subgraph Capa de Servicios - Business Logic
        Service_Order[ğŸ“¦ Order Service\nValidaciÃ³n, cÃ¡lculos\nestado, estimaciones]
        Service_Production[âš™ï¸ Production Service\nGestiÃ³n batches\ntracking progreso]
        Service_Metrics[ğŸ“ˆ Metrics Service\nCÃ¡lculo KPIs\ngeneraciÃ³n reportes]
        Service_Notification[ğŸ”” Notification Service\nAlertas, emails\nwebhooks (futuro)]
    end
    
    subgraph Capa de Datos - Database
        DB_Orders[(ğŸ“„ orders.json<br/>Pedidos y lÃ­neas)]
        DB_Customers[(ğŸ‘¥ customers.json<br/>InformaciÃ³n clientes)]
        DB_Production[(ğŸ­ production_tracking.json<br/>Batches y print items)]
        DB_Projects[(ğŸ“ proyectos.json<br/>CatÃ¡logo de proyectos)]
        DB_Printers[(ğŸ–¨ï¸ printers.json<br/>Flota de impresoras)]
    end
    
    subgraph IntegraciÃ³n con Sistema Existente
        Existing_PrintFlow[ğŸ–¨ï¸ Print Flow Controller<br/>Wizard de impresiÃ³n]
        Existing_RotationWorker[ğŸ”„ Rotation Worker<br/>Procesamiento STL/3MF]
        Existing_Gallery[ğŸ–¼ï¸ Gallery Controller<br/>GestiÃ³n proyectos]
        Existing_Consumables[ğŸ§ª Consumables Controller<br/>GestiÃ³n materiales]
    end
    
    %% Flujo de usuario
    UI_Dashboard --> UI_OrderForm
    UI_Dashboard --> UI_Orders
    UI_Orders --> UI_OrderDetail
    UI_OrderDetail --> UI_Reports
    UI_Dashboard --> UI_Customers
    
    %% Conexiones Frontend-Backend
    UI_OrderForm --> API_Orders
    UI_Orders --> API_Orders
    UI_OrderDetail --> API_Orders
    UI_OrderDetail --> API_Production
    UI_Customers --> API_Customers
    UI_Reports --> API_Metrics
    UI_Dashboard --> API_Metrics
    
    %% Conexiones Controllers-Services
    API_Orders --> Service_Order
    API_Customers --> Service_Order
    API_Production --> Service_Production
    API_Metrics --> Service_Metrics
    
    %% Servicios notifican
    Service_Order --> Service_Notification
    Service_Production --> Service_Notification
    
    %% Servicios acceden a datos
    Service_Order --> DB_Orders
    Service_Order --> DB_Customers
    Service_Order --> DB_Projects
    Service_Production --> DB_Production
    Service_Production --> DB_Orders
    Service_Metrics --> DB_Orders
    Service_Metrics --> DB_Production
    Service_Metrics --> DB_Customers
    
    %% IntegraciÃ³n con sistema existente
    Service_Order -.Valida proyectos.-> Existing_Gallery
    Service_Order -.Valida materiales.-> Existing_Consumables
    Service_Production -.Inicia impresiÃ³n.-> Existing_PrintFlow
    Existing_PrintFlow -.Actualiza progreso.-> Service_Production
    Existing_RotationWorker -.Reporta status.-> Service_Production
    Service_Production -.Lee impresoras.-> DB_Printers
    
    %% Estilos
    classDef frontend fill:#e1f5ff,stroke:#0288d1,stroke-width:2px
    classDef backend fill:#fff3e0,stroke:#f57c00,stroke-width:2px
    classDef service fill:#f3e5f5,stroke:#7b1fa2,stroke-width:2px
    classDef database fill:#e8f5e9,stroke:#388e3c,stroke-width:2px
    classDef existing fill:#fce4ec,stroke:#c2185b,stroke-width:2px
    
    class UI_Dashboard,UI_Orders,UI_OrderDetail,UI_OrderForm,UI_Customers,UI_Reports frontend
    class API_Orders,API_Customers,API_Production,API_Metrics backend
    class Service_Order,Service_Production,Service_Metrics,Service_Notification service
    class DB_Orders,DB_Customers,DB_Production,DB_Projects,DB_Printers database
    class Existing_PrintFlow,Existing_RotationWorker,Existing_Gallery,Existing_Consumables existing
