---
title: Flujo Gestión de Flota KyberCore - Mejorado
---
flowchart TD
    subgraph "Flujo Principal: Carga y CRUD"
        direction LR
        Usuario([Usuario Navegador]) -->|Clic| appjs[app.js]
        appjs -->|CargaModulo| fleet_controller_html["GET /fleet"]
        fleet_controller_html -->|RenderizaHTML| fleethtml[fleet.html]
        appjs -->|InicializaJS| fleetjs[fleet.js]
        fleetjs -->|PideDatos| fleet_controller_data["GET /data"]
        
        subgraph "Proceso Backend (Carga)"
            direction TB
            fleet_controller_data -->|LlamaServicio| fleet_service["fleet_service.py"]
            fleet_service -->|LeeDatos| printersjson["printers.json"]
            printersjson -->|RetornaDatos| fleet_service
            fleet_service -->|RetornaDatos| fleet_controller_data
        end

        fleet_controller_data -->|DevuelveJSON| fleetjs
        fleetjs -->|DibujaUI| fleethtml

        Usuario -->|AccionCRUD| fleethtml
        fleethtml -->|LlamaJS| fleetjs
        fleetjs -->|PeticionAPI| fleet_controller_crud["POST / PUT / DELETE /printers"]
        
        subgraph "Proceso Backend (CRUD)"
            direction TB
            fleet_controller_crud -->|Valida| ia_validator["Servicio Validación/IA"]
            ia_validator -- OK --> fleet_service_crud["fleet_service.py"]
            ia_validator -- Error --- fleet_controller_crud
            fleet_service_crud -->|EjecutaCRUD| printersjson_crud["printers.json"]
            printersjson_crud -->|Confirma| fleet_service_crud
            fleet_service_crud -->|RetornaResultado| fleet_controller_crud
        end
        
        fleet_controller_crud -->|DevuelveJSON| fleetjs
        fleetjs -->|FeedbackUI| Usuario
    end

    subgraph "Flujo Asíncrono: Actualizaciones en Tiempo Real"
        direction TB
        fleetjs_ws[fleet.js] -.->|AbreConexionWS| backend_ws[Backend WS]
        backend_ws <-->|ComunicacionBidireccional| fleetjs_ws
        backend_ws -->|NotificaCambios| fleetjs_ws
        fleetjs_ws -->|ActualizaUI| fleethtml
    end

    classDef frontend fill:#dae8fc,stroke:#6c8ebf;
    classDef backend fill:#d5e8d4,stroke:#82b366;
    classDef db fill:#f8cecc,stroke:#b85450;
    classDef user fill:#fff2cc,stroke:#d6b656;

    class appjs,fleetjs,fleethtml,fleetjs_ws frontend;
    class fleet_controller_html,fleet_controller_data,fleet_controller_crud,fleet_service,fleet_service_crud,ia_validator,backend_ws backend;
    class printersjson,printersjson_crud db;
    class Usuario user;
