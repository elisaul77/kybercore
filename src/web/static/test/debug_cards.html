<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Debug Sistema de Tarjetas - KyberCore</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100 p-8">
    <div class="max-w-4xl mx-auto">
        <h1 class="text-3xl font-bold mb-6">üîç Debug Sistema de Tarjetas Modular</h1>
        
        <div class="bg-white p-6 rounded-lg shadow mb-6">
            <h2 class="text-xl font-semibold mb-4">Estado de Carga de M√≥dulos</h2>
            <div id="module-status" class="space-y-2">
                <p>Cargando...</p>
            </div>
        </div>
        
        <div class="bg-white p-6 rounded-lg shadow mb-6">
            <h2 class="text-xl font-semibold mb-4">Funciones Globales</h2>
            <div id="global-functions" class="space-y-2">
                <p>Verificando...</p>
            </div>
        </div>
        
        <div class="bg-white p-6 rounded-lg shadow mb-6">
            <h2 class="text-xl font-semibold mb-4">Test de Funcionalidad</h2>
            <div class="space-x-2">
                <button onclick="testShowDetails()" class="px-4 py-2 bg-blue-500 text-white rounded hover:bg-blue-600">
                    Test Mostrar Detalles
                </button>
                <button onclick="runFullDebug()" class="px-4 py-2 bg-green-500 text-white rounded hover:bg-green-600">
                    Debug Completo
                </button>
                <button onclick="testModules()" class="px-4 py-2 bg-purple-500 text-white rounded hover:bg-purple-600">
                    Test M√≥dulos
                </button>
            </div>
            <div id="test-results" class="mt-4 p-4 bg-gray-50 rounded">
                <p>Ejecuta un test para ver los resultados</p>
            </div>
        </div>
        
        <div class="bg-white p-6 rounded-lg shadow">
            <h2 class="text-xl font-semibold mb-4">Consola de Logs</h2>
            <div id="console-logs" class="bg-black text-green-400 p-4 rounded font-mono text-sm h-64 overflow-y-auto">
                <p>Abre la consola del navegador (F12) para ver logs detallados</p>
            </div>
        </div>
    </div>

    <!-- Cargar m√≥dulos en el mismo orden que en la aplicaci√≥n -->
    <script src="/static/js/fleet/cards_printer/core.js"></script>
    <script src="/static/js/fleet/cards_printer/utils.js"></script>
    <script src="/static/js/fleet/cards_printer/renderer.js"></script>
    <script src="/static/js/fleet/cards_printer/gcode_files.js"></script>
    <script src="/static/js/fleet/cards_printer/thumbnails.js"></script>
    <script src="/static/js/fleet/cards_printer/commands.js"></script>
    <script src="/static/js/fleet/cards.js"></script>

    <script>
        function updateModuleStatus() {
            const modules = ['Core', 'Utils', 'Renderer', 'GcodeFiles', 'Thumbnails', 'Commands'];
            const statusDiv = document.getElementById('module-status');
            let html = '';
            
            html += `<p><strong>window.FleetCards:</strong> ${window.FleetCards ? '‚úÖ Disponible' : '‚ùå No disponible'}</p>`;
            
            if (window.FleetCards) {
                modules.forEach(module => {
                    const available = window.FleetCards[module] ? '‚úÖ' : '‚ùå';
                    html += `<p><strong>${module}:</strong> ${available} ${window.FleetCards[module] ? 'Disponible' : 'No disponible'}</p>`;
                });
            }
            
            statusDiv.innerHTML = html;
        }
        
        function updateGlobalFunctions() {
            const functions = [
                'showPrinterDetails', 'hidePrinterDetails', 'pausePrint', 'resumePrint', 
                'cancelPrint', 'homeAxes', 'restartKlipper', 'restartFirmware',
                'startGcodePrint', 'deleteGcodeFile', 'showFileUploadDialog'
            ];
            
            const functionsDiv = document.getElementById('global-functions');
            let html = '';
            
            functions.forEach(func => {
                const available = window[func] ? '‚úÖ' : '‚ùå';
                html += `<p><strong>${func}:</strong> ${available} ${window[func] ? 'Disponible' : 'No disponible'}</p>`;
            });
            
            functionsDiv.innerHTML = html;
        }
        
        function testShowDetails() {
            const resultsDiv = document.getElementById('test-results');
            
            try {
                console.log('üß™ Testing showPrinterDetails...');
                
                if (window.showPrinterDetails) {
                    // Test con ID de prueba
                    window.showPrinterDetails('test-printer-1');
                    resultsDiv.innerHTML = `<p class="text-green-600">‚úÖ Test showPrinterDetails ejecutado. Revisa la consola para m√°s detalles.</p>`;
                } else {
                    resultsDiv.innerHTML = `<p class="text-red-600">‚ùå showPrinterDetails no est√° disponible</p>`;
                }
            } catch (error) {
                resultsDiv.innerHTML = `<p class="text-red-600">‚ùå Error: ${error.message}</p>`;
                console.error('Error en test:', error);
            }
        }
        
        function runFullDebug() {
            const resultsDiv = document.getElementById('test-results');
            
            try {
                console.log('üîç Ejecutando debug completo...');
                
                if (window.debugFleetCards) {
                    window.debugFleetCards();
                    resultsDiv.innerHTML = `<p class="text-green-600">‚úÖ Debug completo ejecutado. Revisa la consola para detalles.</p>`;
                } else {
                    resultsDiv.innerHTML = `<p class="text-orange-600">‚ö†Ô∏è debugFleetCards no disponible</p>`;
                }
            } catch (error) {
                resultsDiv.innerHTML = `<p class="text-red-600">‚ùå Error: ${error.message}</p>`;
                console.error('Error en debug:', error);
            }
        }
        
        function testModules() {
            const resultsDiv = document.getElementById('test-results');
            
            try {
                console.log('üß™ Testing m√≥dulos...');
                
                if (window.FleetCards && window.FleetCards.testAllModules) {
                    const results = window.FleetCards.testAllModules();
                    let html = '<p class="text-blue-600">üìä Resultados de tests de m√≥dulos:</p><ul class="list-disc list-inside mt-2">';
                    Object.keys(results).forEach(module => {
                        const status = results[module];
                        const color = status.includes('passed') ? 'text-green-600' : 
                                    status.includes('failed') ? 'text-red-600' : 'text-gray-600';
                        html += `<li class="${color}">${module}: ${status}</li>`;
                    });
                    html += '</ul>';
                    resultsDiv.innerHTML = html;
                } else {
                    resultsDiv.innerHTML = `<p class="text-red-600">‚ùå FleetCards.testAllModules no disponible</p>`;
                }
            } catch (error) {
                resultsDiv.innerHTML = `<p class="text-red-600">‚ùå Error: ${error.message}</p>`;
                console.error('Error en test de m√≥dulos:', error);
            }
        }
        
        // Inicializar al cargar la p√°gina
        document.addEventListener('DOMContentLoaded', function() {
            console.log('üöÄ Iniciando debug de sistema de tarjetas...');
            
            // Esperar un momento para que se carguen todos los scripts
            setTimeout(() => {
                updateModuleStatus();
                updateGlobalFunctions();
                
                // Intentar inicializar FleetCards si est√° disponible
                if (window.FleetCards && window.FleetCards.init) {
                    console.log('üé¥ Inicializando FleetCards...');
                    const initResult = window.FleetCards.init();
                    console.log('Resultado de inicializaci√≥n:', initResult);
                    
                    // Actualizar estados despu√©s de la inicializaci√≥n
                    setTimeout(() => {
                        updateModuleStatus();
                        updateGlobalFunctions();
                    }, 500);
                }
            }, 1000);
        });
    </script>
</body>
</html>
